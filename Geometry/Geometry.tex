\chapter{Геометрия твердых тел}
\section{Геометрические примитивы}
Описание движения тела полностью абстрагировано от его формы
или, как принято выражаться, геометрии --- это очень важно
уяснить для понимания внутренней архитектуры физического
движка.

Основными геометрическими примитивами используемыми в физических движках являются:
\begin{itemize}
 \item  луч, 
 \item  плоскость,
 \item  полигон,
 \item  сфера,
 \item  треугольник
 \end{itemize}
Для реализации более сложных геометрических тел используется композиция тел представленных выше.

Рассмотрим более подробно один основных из геометрических примитивов --- сферу.
Сфера может быть описана в пространстве положением своего геометрического цента(он же является и центром масс)
и радиуса. Таким образом для описания сферы достаточно 4 компонент : вектора положения центра сферы( 3 компоненты) и радиуса сферы.

%TODO Рассмотреть большее количество геометрически примитивов

\section{Контакт геометрических тел}
Реализации твердого тела и геометрического объекта как правило раздельны --- геометрия тела играет роль только в
процессе обнаружения столкновений, рассматриваемый ниже.

Модули обнаружения столкновений (\textit{collision detection}) и реагирования на столкновения (\textit{collision responce}) представляют 
собой ключевые компоненты любого физического движка. Именно они в процессе симуляции осуществляют главную нагрузку на
процессор, и именно от них требуется максимальная точность.

\subsection{Обнаружение столкновений}
Методы обнаружения столкновений подразделяются на две категории: статические и динамические. В первом случае
движение тел рассматривается как последовательность «квантовых скачков» --- проверка на пересечение двух геометрий
производится в промежутках между скачками, как если бы объекты в этом время не двигались (то есть, имели нулевые
скорости). Основным допущением этого метода является временная когерентность системы --- предполагается, что тела
обладают небольшими скоростями, и их позиции не меняются слишком резко с течением времени. Иными словами,
статическое обнаружение столкновений плохо подходит для моделирования, например, пушки, стреляющей в бетонную
стену: за шаг времени ($\Delta{t}$) снаряд пройдет расстояние, значительно превышающее толщину стены, и, следовательно,
попросту пролетит сквозь нее --- статическая проверка это столкновение не обнаружит.

Динамическое обнаружение столкновений\cite{Ericson} использует другой метод, при котором учитывается скорость тела --- движок
предсказывает, какое положение в пространстве займет объект на следующем шаге времени, если будет двигаться с той же
скоростью. Фактически, делается проверка на пересечение отрезка, представляющего собой траекторию движения тела, с
препятствием --- вычисляется точка, в которой тело столкнется с этим препятствием, и на основании этой информации движок
делает соответствующие корректировки. К сожалению, динамический метод довольно сложен (особенно для
нетривиальных геометрий) и, в целом, плохо адаптирован для динамики как таковой --- он чаще используется в кинематике.
Поэтому далее будет рассматриваться статический метода --- он, при всех его недостатках, хорошо себя оправдывает в
большинстве физических ситуаций.

В физическом движке функция проверки столкновения между двумя объектами должна давать на выходе следующую
информацию:
\begin{itemize}
  \item точка контакта
  \item вектор нормали к поверхности столкновения в этой точке (нормаль контакта)
  \item глубина взаимного проникновения объектов
\end{itemize}

\begin{figure}[ht!]
\begin{center}
\includegraphics[scale=0.45]{./Geometry/SphereCollision.eps} \\
\caption{Контакт двух сфер}\label{SphereCollision} 
\end{center}
\end{figure}
Эти три свойства, вкупе со ссылками на столкнувшиеся тела, дают новую сущность --- контакт. Соответственно,
процесс обнаружения столкновений в терминологии физического движка также называют генерированием
контактов (\textit{contact generation}). В сложных движках на одно столкновение между двумя телами приходится несколько
контактов --- так называемый \textit{contact manifold}. Далее будет рассматриваться простейший случай --- столкновение сфер, где будет
достаточно одного контакта на пару столкнувшихся тел.

Рассмотрим одно очевидным свойство. Если сумма радиусов двух сфер превышает расстояние между их центрами, следовательно, сферы пересекаются.
При этом нормаль столкновения --- это нормированный вектор от центра второй сферы в сторону центра первой,
точка столкновения --- экстремальная точка на поверхности второй сферы в направлении этого вектора, а глубина взаимного
проникновения --- разница между суммой радиусов и расстоянием (см. рисунок \ref{SphereCollision}). % здесь ссылка возможно 
% и не нужна, вставил для пробы

Таким образом можно легко обнаружить столкновение таких двух примитивов как сферы.
\subsection{Реагирование на столкновение}
Получив необходимую информацию о контакте(точку контакта, нормаль контакта и глубину проникновения), модулю реагирования
на столкновения необходимо скоординировать скорости тел таким образом, чтобы тела перестали пересекаться и проникать друг в друга.  

При моделировании используются алгоритм отличный от реального поведения: объекты выталкиваются вдоль вектора нормали на величину,
равную половине глубины взаимопроникновения:

\begin{equation}
\mathbf{x} = \frac{1}{2}\mathbf{x}_0 + d\mathbf{n}
\end{equation}
\begin{eqrem}
$\mathbf{x}_0$ --- точка контакта,

$d$ --- глубина взаимопроникновения,

$\mathbf{n}$ --- вектор нормали контакта.
\end{eqrem}

Первый объект выталкивается вдоль $+\mathbf{n}$, а второй – вдоль $-\mathbf{n}$ (вектор нормали контакта указывает от второго тела к первому).

Эту операцию называют также корректировкой позиций (\textit{position correction}). Но такой подход нестабилен, кроме того,
необходимо учитывать массы тел и, следовательно, импульс.

Импульс – это векторная величина, мера механического движения тела. Вращательным аналогом импульса является момент импульса.
\begin{equation}
\mathbf{L} = \mathbf{r}\times\mathbf{p}
\end{equation}
\begin{eqrem}
$\mathbf{p}$ --- линейный импульс,

$\mathbf{r}$ --- радиус-вектор (точка, к которой приложен линейный импульс).
\end{eqrem}